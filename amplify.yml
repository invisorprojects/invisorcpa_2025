version: 1
frontend:
    phases:
        preBuild:
            commands:
                - npm install -g pnpm
                - pnpm install --frozen-lockfile
                - env | grep -e PAYLOAD_SECRET -e DATABASE_URI  >> .env
        build:
            commands:
                - pnpm run build
                - rm -f node_modules/@swc/core-linux-x64-gnu/swc.linux-x64-gnu.node
                - rm -f node_modules/@swc/core-linux-x64-musl/swc.linux-x64-musl.node
    artifacts:
        baseDirectory: .next
        files:
            - '**/*'
    cache:
        paths:
            - $(pnpm store path)
            - .next/cache/**/*
